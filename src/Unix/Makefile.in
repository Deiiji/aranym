# Unix makefile for ARAnyM
# Inspired in BasiliskII's Makefile

## System specific configuration
@SET_MAKE@
SHELL = /bin/sh

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
datadir = @datadir@
mandir = @mandir@
man1dir = $(mandir)/man1
docdir = $(prefix)/share/doc

DESTDIR =

CC = @CC@
CXX = @CXX@
CFLAGS = -I../include -I. -I../natfeat @CFLAGS@
CXXFLAGS = @CXXFLAGS@
CPPFLAGS = -I../include -I. -I../natfeat @CPUINCLUDES@ @CPPFLAGS@
WFLAGS = @WFLAGS@
DEFS = @DEFS@ @DEFINES@ -D_REENTRANT -D_THREAD_SAFE
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
SDL_LIBS = @SDL_LIBS@
SDL_CONFIG = @SDL_CONFIG@
SDL_CFLAGS = @SDL_CFLAGS@
SYSSRCS = @SYSSRCS@
CPUSRCS = @CPUSRCS@
DSPSRCS = @DSPSRCS@
LILOSRCS = @LILOSRCS@
NFCDROMSRCS = @NFCDROMSRCS@
NFPCISRCS = @NFPCISRCS@
NFOSMESASRCS = @NFOSMESASRCS@
NFJPEGSRCS = @NFJPEGSRCS@
NFVDIGLSRCS = @NFVDIGLSRCS@
PARALLELX86SRCS = @PARALLELX86SRCS@
PARALLELPARPORTSRCS = @PARALLELPARPORTSRCS@
GUISDLSRCS = @GUISDLSRCS@
DBGSP = @DBGSP@
TAPIF = @TAPIF@

ACLOCAL = aclocal
AUTOCONF = autoconf
AUTOHEADER = autoheader

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@ -s
INSTALL_DATA = @INSTALL_DATA@

host_alias = @host_alias@
host_triplet = @host@

## Files
SRCS = ../main.cpp \
	main_unix.cpp \
	vm_alloc.cpp \
	../acia.cpp \
	../acsifdc.cpp \
	../aradata.cpp \
	../ata.cpp \
	../audio.cpp \
	../audio_dma.cpp \
	../audio_crossbar.cpp \
	../blitter.cpp \
	../cdrom.cpp \
	../cfgopts.c \
	../dsp.cpp \
	../emul_op.cpp \
	../natfeats.cpp \
	../fakeio.cpp \
	../hardware.cpp \
	../host.cpp \
	../hostscreen.cpp \
	../ide.cpp \
	../identify.cpp \
	../ikbd.cpp \
	../input.cpp \
	../md5.cpp \
	../mfp.cpp \
	../midi.cpp \
	../mmu.cpp \
	../ndebug.cpp \
	../ncr5380.cpp \
	../parallel.cpp \
	../parallel_file.cpp \
	../parameters.cpp \
	../romdiff.cpp \
	../rtc.cpp \
	../tools.cpp \
	../videl.cpp \
	../yamaha.cpp \
	../natfeat/nf_base.cpp \
	../natfeat/nf_objs.cpp \
	../natfeat/xhdi.cpp \
	../natfeat/nfaudio.cpp \
	../natfeat/nf_basicset.cpp \
	../natfeat/debugprintf.cpp \
	../natfeat/nfvdi.cpp \
	../natfeat/nfvdi_soft.cpp \
	$(NFCDROMSRCS) \
	$(NFPCISRCS) \
	$(NFOSMESASRCS) \
	$(NFJPEGSRCS) \
	$(NFVDIGLSRCS) \
	$(PARALLELX86SRCS) \
	$(PARALLELPARPORTSRCS) \
	$(SYSSRCS) \
	$(CPUSRCS) \
	$(DSPSRCS) \
	$(LILOSRCS) \
	$(GUISDLSRCS)

BUNDLE_RESOURCES = \
	darwin/aranym2.icns \
	
BUNDLE_LOCALIZATON_ROOT = \
	darwin/
BUNDLE_LOCALIZATON_ROOT_REMOVE = \
	../

BUNDLE_LOCALIZATON_FOLDERS = \
	*.lproj
	
BUNDLE_LOCALIZATON_FILES = \
	aranym.nib
	
BUNDLE_CONTENTS = \
	darwin/info.plist \
	darwin/PkgInfo 	

APP = aranym
APP_STATIC = aranym-static
APP_LIB = libaranym.a
APP_BUNDLE = ARAnym.app
APP_IFC = aratapif
TARGET = @TARGET@

## Rules
.PHONY: install installdirs uninstall mostlyclean clean distclean depend dep $(APP_BUNDLE)
.SUFFIXES:
.SUFFIXES: .c .cpp .s .o .h .m .M

all: $(TARGET) $(TAPIF)

OBJ_DIR = obj
$(OBJ_DIR)::
	@[ -d $(OBJ_DIR) ] || mkdir $(OBJ_DIR) > /dev/null 2>&1

define SRCS_LIST_TO_OBJS
	$(addprefix $(OBJ_DIR)/, $(addsuffix .o, $(foreach file, $(SRCS), \
	$(basename $(notdir $(file))))))
endef

define DEPSRCS
	$(addsuffix .o, $(foreach file, $(SRCS), \
	$(basename $(notdir $(file)))))
endef

OBJS = $(SRCS_LIST_TO_OBJS)

SRC_PATHS += $(sort $(foreach file, $(SRCS), $(dir $(file))))
VPATH :=
VPATH += $(addprefix :, $(subst  ,:, $(filter-out $($(subst, :, ,$(VPATH))), $(SRC_PATHS))))

$(APP): $(OBJ_DIR) $(OBJS)
	$(CXX) -o $(APP) $(LDFLAGS) $(OBJS) $(LIBS)

$(APP_STATIC): $(OBJ_DIR) $(OBJS)
	$(CXX) -o $(APP_STATIC) -static $(LDFLAGS) $(OBJS) $(LIBS)

$(APP_LIB): $(OBJ_DIR) $(OBJS)
	$(LD) -r -o $(APP_LIB) $(LDFLAGS) $(OBJS) $(LIBS)

$(APP_BUNDLE): $(APP)
	rm -rf $(APP_BUNDLE)
	mkdir -p $(APP_BUNDLE)/Contents
	cp -r $(BUNDLE_CONTENTS) $(APP_BUNDLE)/Contents
	mkdir -p $(APP_BUNDLE)/Contents/MacOS
	cp $(APP) $(APP_BUNDLE)/Contents/MacOS
	#mkdir -p $(APP_BUNDLE)/Contents/ARAnyM
	mkdir -p $(APP_BUNDLE)/Contents/Resources
	cp -r $(BUNDLE_RESOURCES) $(APP_BUNDLE)/Contents/Resources
	cd $(BUNDLE_LOCALIZATON_ROOT); \
		for locFolder in $(BUNDLE_LOCALIZATON_FOLDERS); do \
			mkdir -p $(BUNDLE_LOCALIZATON_ROOT_REMOVE)$(APP_BUNDLE)/Contents/Resources/$$locFolder; \
			for locFile in $(BUNDLE_LOCALIZATON_FILES); do \
				cp -r $$locFolder/$$locFile \
					$(BUNDLE_LOCALIZATON_ROOT_REMOVE)$(APP_BUNDLE)/Contents/Resources/$$locFolder/$$locFile; \
				rm -rf $(BUNDLE_LOCALIZATON_ROOT_REMOVE)$(APP_BUNDLE)/Contents/Resources/$$locFolder/$$locFile/CVS; \
				rm -rf $(BUNDLE_LOCALIZATON_ROOT_REMOVE)$(APP_BUNDLE)/Contents/Resources/$$locFolder/$$locFile/*/CVS; \
			done; \
		done

install: $(APP) $(TAPIF) $(APP).1.gz installdirs
	$(INSTALL_PROGRAM) $(APP) $(DESTDIR)$(bindir)/$(APP)
	if [ "x$(APP_IFC)" = "x$(TAPIF)" ]; then\
	$(INSTALL_PROGRAM) $(APP_IFC) $(DESTDIR)$(bindir)/$(APP_IFC);\
	fi
	$(INSTALL_DATA) $(APP).1.gz $(DESTDIR)$(man1dir)/$(APP).1.gz
	$(INSTALL_DATA) ../../ChangeLog $(DESTDIR)$(docdir)/$(APP)/changelog
	$(INSTALL_DATA) ../../TODO $(DESTDIR)$(docdir)/$(APP)/TODO
	$(INSTALL_DATA) ../../AUTHORS $(DESTDIR)$(docdir)/$(APP)/AUTHORS
	$(INSTALL_DATA) ../../NEWS $(DESTDIR)$(docdir)/$(APP)/NEWS
	$(INSTALL_DATA) ../../README $(DESTDIR)$(docdir)/$(APP)/README
	$(INSTALL_DATA) ../../FAQ $(DESTDIR)$(docdir)/$(APP)/FAQ
	$(INSTALL_DATA) ../../COPYING $(DESTDIR)$(docdir)/$(APP)/COPYING
	$(INSTALL_DATA) ../../BUGS $(DESTDIR)$(docdir)/$(APP)/BUGS
	$(INSTALL_DATA) ../../INSTALL $(DESTDIR)$(docdir)/$(APP)/INSTALL
	$(INSTALL_DATA) ../../doc/aranym.html $(DESTDIR)$(docdir)/$(APP)/aranym.html
	$(INSTALL_DATA) ../../doc/config $(DESTDIR)$(docdir)/$(APP)/config
# JOY, uncomment it for releases
#	$(INSTALL_DATA) ../../data/etos512k.img $(DESTDIR)$(datadir)/$(APP)/etos512k.img
	$(INSTALL_DATA) ../../atari/newdesk.inf $(DESTDIR)$(datadir)/$(APP)/atari/newdesk.inf
	$(INSTALL_DATA) ../../atari/mmusetup.cnf $(DESTDIR)$(datadir)/$(APP)/atari/mmusetup.cnf
	$(INSTALL_DATA) ../../atari/hostfs/bin/hostfs.dos.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/hostfs/hostfs.dos.bz2
	$(INSTALL_DATA) ../../atari/hostfs/bin/hostfs.xfs.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/hostfs/hostfs.xfs.bz2
	$(INSTALL_DATA) ../../atari/nfcdrom/nfcdrom.bos.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/nfcdrom/nfcdrom.bos.bz2
	$(INSTALL_DATA) ../../atari/nfjpeg/nfjpeg.prg.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/nfjpeg/nfjpeg.prg.bz2
	$(INSTALL_DATA) ../../atari/nfosmesa/osmesa.ldg.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/nfosmesa/osmesa.ldg.bz2
	$(INSTALL_DATA) ../../atari/hostfs/bdconfig.sys $(DESTDIR)$(datadir)/$(APP)/atari/hostfs/bdconfig.sys
	$(INSTALL_DATA) ../../atari/hostfs/README $(DESTDIR)$(datadir)/$(APP)/atari/hostfs/README
	$(INSTALL_DATA) ../../atari/network/ethernet/bin/aranym.xif.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/network/aranym.xif.bz2
	$(INSTALL_DATA) ../../atari/network/ethernet/nfeth-config/nfeth-config.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/network/nfeth-config.bz2
	$(INSTALL_DATA) ../../atari/network/ethernet/nfeth-config/eth0-config.sh $(DESTDIR)$(datadir)/$(APP)/atari/network/eth0-config.sh
	$(INSTALL_DATA) ../../atari/network/ethernet/README $(DESTDIR)$(datadir)/$(APP)/atari/network/README
	$(INSTALL) ../../tools/arabridge $(DESTDIR)$(datadir)/$(APP)/arabridge
	$(INSTALL) ../../tools/floppy.sh $(DESTDIR)$(datadir)/$(APP)/floppy.sh
	$(INSTALL_DATA) ../../atari/fvdi/drivers/aranym.sys.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/fvdi/aranym.sys.bz2
	$(INSTALL_DATA) ../../atari/fvdi/fvdi.sys $(DESTDIR)$(datadir)/$(APP)/atari/fvdi/fvdi.sys
	$(INSTALL_DATA) ../../atari/tools/README $(DESTDIR)$(datadir)/$(APP)/atari/tools/README
	$(INSTALL_DATA) ../../atari/tools/clocky.prg.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/tools/clocky.prg.bz2
	$(INSTALL_DATA) ../../atari/tools/fastram.prg.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/tools/fastram.prg.bz2
	$(INSTALL_DATA) ../../atari/tools/pc101us.kbd.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/tools/pc101us.kbd.bz2
	$(INSTALL_DATA) ../../atari/tools/pcpatch.prg.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/tools/pcpatch.prg.bz2
	$(INSTALL_DATA) ../../atari/sound/zmagxsnd.prg.bz2 $(DESTDIR)$(datadir)/$(APP)/atari/sound/zmagxsnd.prg.bz2
	$(INSTALL_DATA) ../../atari/sound/README $(DESTDIR)$(datadir)/$(APP)/atari/sound/README
	
installdirs:
	$(SHELL) mkinstalldirs $(DESTDIR)$(bindir) $(DESTDIR)$(man1dir) $(DESTDIR)$(datadir)/$(APP) $(DESTDIR)$(datadir)/$(APP)/atari $(DESTDIR)$(datadir)/$(APP)/atari/hostfs $(DESTDIR)$(datadir)/$(APP)/atari/nfcdrom $(DESTDIR)$(datadir)/$(APP)/atari/nfjpeg $(DESTDIR)$(datadir)/$(APP)/atari/nfosmesa $(DESTDIR)$(datadir)/$(APP)/atari/network $(DESTDIR)$(datadir)/$(APP)/atari/fvdi $(DESTDIR)$(datadir)/$(APP)/atari/tools $(DESTDIR)$(datadir)/$(APP)/atari/sound $(DESTDIR)$(docdir)/$(APP)

uninstall:
	rm -f $(DESTDIR)$(bindir)/$(APP)
	if [ "x$(APP_IFC)" = "x$(TAPIF)" ]; then\
	rm -f $(DESTDIR)$(bindir)/$(APP_IFC);\
	fi
	rm -f $(DESTDIR)$(man1dir)/$(APP).1.gz
	rm -f $(DESTDIR)$(docdir)/$(APP)/changelog
	rm -f $(DESTDIR)$(docdir)/$(APP)/TODO
	rm -f $(DESTDIR)$(docdir)/$(APP)/AUTHORS
	rm -f $(DESTDIR)$(docdir)/$(APP)/NEWS
	rm -f $(DESTDIR)$(docdir)/$(APP)/README
	rm -f $(DESTDIR)$(docdir)/$(APP)/FAQ
	rm -f $(DESTDIR)$(docdir)/$(APP)/COPYING
	rm -f $(DESTDIR)$(docdir)/$(APP)/BUGS
	rm -f $(DESTDIR)$(docdir)/$(APP)/INSTALL
	rm -f $(DESTDIR)$(docdir)/$(APP)/aranym.html
	rm -f $(DESTDIR)$(docdir)/$(APP)/config
# JOY, uncomment it for releases
#	rm -f $(DESTDIR)$(datadir)/$(APP)/etos512k.img
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/newdesk.inf
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/mmusetup.cnf
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/hostfs/hostfs.dos.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/hostfs/hostfs.xfs.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/nfcdrom/nfcdrom.bos.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/nfjpeg/nfjpeg.prg.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/nfosmesa/osmesa.ldg.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/hostfs/bdconfig.sys
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/hostfs/README
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/network/aranym.xif.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/network/nfeth-config.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/network/eth0-config.sh
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/network/README
	rm -f $(DESTDIR)$(datadir)/$(APP)/arabridge
	rm -f $(DESTDIR)$(datadir)/$(APP)/floppy.sh
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/fvdi/aranym.sys.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/fvdi/fvdi.sys
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/tools/README
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/tools/clocky.prg.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/tools/fastram.prg.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/tools/pc101us.kbd.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/tools/pcpatch.prg.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/sound/zmagxsnd.prg.bz2
	rm -f $(DESTDIR)$(datadir)/$(APP)/atari/sound/README
	rmdir $(DESTDIR)$(datadir)/$(APP)/atari/hostfs
	rmdir $(DESTDIR)$(datadir)/$(APP)/atari/nfcdrom
	rmdir $(DESTDIR)$(datadir)/$(APP)/atari/nfjpeg
	rmdir $(DESTDIR)$(datadir)/$(APP)/atari/nfosmesa
	rmdir $(DESTDIR)$(datadir)/$(APP)/atari/network
	rmdir $(DESTDIR)$(datadir)/$(APP)/atari/fvdi
	rmdir $(DESTDIR)$(datadir)/$(APP)/atari/tools
	rmdir $(DESTDIR)$(datadir)/$(APP)/atari/sound
	rmdir $(DESTDIR)$(datadir)/$(APP)/atari
	rmdir $(DESTDIR)$(datadir)/$(APP)
	rmdir $(DESTDIR)$(docdir)/$(APP)

mostlyclean:
	rm -f $(APP) $(TAPIF) $(APP).1.gz $(OBJ_DIR)/* core* *.core *~ *.bak

clean: mostlyclean
	rm -f cpuemu.cpp cpudefs.cpp cputmp*.s cpufast*.s cpustbl.cpp cputbl.h newcpu.s memory.s compemu.cpp compstbl.cpp comptbl.h

distclean: clean
	rm -rf $(OBJ_DIR)
	rm -f Makefile
	rm -f config.cache config.log config.status config.h
	rm -f cmos aranymtest.rc
	rm -rf autom4te.cache

mrproper: distclean
	rm -rf aclocal.m4 configure config.h.in

bindistdirs:
	$(SHELL) mkinstalldirs tmpdist tmpdist$(bindir) tmpdist$(man1dir) tmpdist$(datadir)/$(APP) tmpdist$(datadir)/$(APP)/atari tmpdist$(datadir)/$(APP)/atari/hostfs tmpdist$(datadir)/$(APP)/atari/nfcdrom tmpdist$(datadir)/$(APP)/atari/nfjpeg tmpdist$(datadir)/$(APP)/atari/nfosmesa tmpdist$(datadir)/$(APP)/atari/network tmpdist$(datadir)/$(APP)/atari/fvdi tmpdist$(datadir)/$(APP)/atari/tools tmpdist$(datadir)/$(APP)/atari/sound tmpdist$(docdir)/$(APP)

bindist: $(APP) $(TAPIF) $(APP).1.gz bindistdirs
	$(INSTALL_PROGRAM) $(APP) tmpdist$(bindir)/$(APP)
	if [ "x$(APP_IFC)" = "x$(TAPIF)" ]; then\
	$(INSTALL_PROGRAM) $(APP_IFC) tmpdist$(bindir)/$(APP_IFC);\
	fi
	$(INSTALL_DATA) $(APP).1.gz tmpdist$(man1dir)/$(APP).1.gz
	$(INSTALL_DATA) ../../ChangeLog tmpdist$(docdir)/$(APP)/changelog
	$(INSTALL_DATA) ../../TODO tmpdist$(docdir)/$(APP)/TODO
	$(INSTALL_DATA) ../../AUTHORS tmpdist$(docdir)/$(APP)/AUTHORS
	$(INSTALL_DATA) ../../NEWS tmpdist$(docdir)/$(APP)/NEWS
	$(INSTALL_DATA) ../../README tmpdist$(docdir)/$(APP)/README
	$(INSTALL_DATA) ../../FAQ tmpdist$(docdir)/$(APP)/FAQ
	$(INSTALL_DATA) ../../COPYING tmpdist$(docdir)/$(APP)/COPYING
	$(INSTALL_DATA) ../../BUGS tmpdist$(docdir)/$(APP)/BUGS
	$(INSTALL_DATA) ../../INSTALL tmpdist$(docdir)/$(APP)/INSTALL	
	$(INSTALL_DATA) ../../doc/aranym.html tmpdist$(docdir)/$(APP)/aranym.html
	$(INSTALL_DATA) ../../doc/config tmpdist$(docdir)/$(APP)/config
# JOY, uncomment it for releases
#	$(INSTALL_DATA) ../../data/etos512k.img tmpdist$(datadir)/$(APP)/etos512k.img
	$(INSTALL_DATA) ../../atari/newdesk.inf tmpdist$(datadir)/$(APP)/atari/newdesk.inf
	$(INSTALL_DATA) ../../atari/mmusetup.cnf tmpdist$(datadir)/$(APP)/atari/mmusetup.cnf
	$(INSTALL_DATA) ../../atari/hostfs/bin/hostfs.dos.bz2 tmpdist$(datadir)/$(APP)/atari/hostfs/hostfs.dos.bz2
	$(INSTALL_DATA) ../../atari/hostfs/bin/hostfs.xfs.bz2 tmpdist$(datadir)/$(APP)/atari/hostfs/hostfs.xfs.bz2
	$(INSTALL_DATA) ../../atari/nfcdrom/nfcdrom.bos.bz2 tmpdist$(datadir)/$(APP)/atari/nfcdrom/nfcdrom.bos.bz2
	$(INSTALL_DATA) ../../atari/nfjpeg/nfjpeg.prg.bz2 tmpdir$(datadir)/$(APP)/atari/nfjpeg/nfjpeg.prg.bz2
	$(INSTALL_DATA) ../../atari/nfosmesa/osmesa.ldg.bz2 tmpdir$(datadir)/$(APP)/atari/nfosmesa/osmesa.ldg.bz2
	$(INSTALL_DATA) ../../atari/hostfs/bdconfig.sys tmpdist$(datadir)/$(APP)/atari/hostfs/bdconfig.sys
	$(INSTALL_DATA) ../../atari/hostfs/README tmpdist$(datadir)/$(APP)/atari/hostfs/README
	$(INSTALL_DATA) ../../atari/network/ethernet/bin/aranym.xif.bz2 tmpdist$(datadir)/$(APP)/atari/network/aranym.xif.bz2
	$(INSTALL_DATA) ../../atari/network/ethernet/nfeth-config/nfeth-config.bz2 tmpdist$(datadir)/$(APP)/atari/network/nfeth-config.bz2
	$(INSTALL_DATA) ../../atari/network/ethernet/nfeth-config/eth0-config.sh tmpdist$(datadir)/$(APP)/atari/network/eth0-config.sh
	$(INSTALL_DATA) ../../atari/network/ethernet/README tmpdist$(datadir)/$(APP)/atari/network/README
	$(INSTALL) ../../tools/arabridge tmpdist$(datadir)/$(APP)/arabridge
	$(INSTALL) ../../tools/floppy.sh tmpdist$(datadir)/$(APP)/floppy.sh
	$(INSTALL_DATA) ../../atari/fvdi/drivers/aranym.sys.bz2 tmpdist$(datadir)/$(APP)/atari/fvdi/aranym.sys.bz2
	$(INSTALL_DATA) ../../atari/fvdi/fvdi.sys tmpdist$(datadir)/$(APP)/atari/fvdi/fvdi.sys
	$(INSTALL_DATA) ../../atari/tools/README tmpdist$(datadir)/$(APP)/atari/tools/README
	$(INSTALL_DATA) ../../atari/tools/clocky.prg.bz2 tmpdist$(datadir)/$(APP)/atari/tools/clocky.prg.bz2
	$(INSTALL_DATA) ../../atari/tools/fastram.prg.bz2 tmpdist$(datadir)/$(APP)/atari/tools/fastram.prg.bz2
	$(INSTALL_DATA) ../../atari/tools/pc101us.kbd.bz2 tmpdist$(datadir)/$(APP)/atari/tools/pc101us.kbd.bz2
	$(INSTALL_DATA) ../../atari/tools/pcpatch.prg.bz2 tmpdist$(datadir)/$(APP)/atari/tools/pcpatch.prg.bz2	
	$(INSTALL_DATA) ../../atari/sound/zmagxsnd.prg.bz2 tmpdist$(datadir)/$(APP)/atari/sound/zmagxsnd.prg.bz2	
	$(INSTALL_DATA) ../../atari/sound/README tmpdist$(datadir)/$(APP)/atari/sound/README
	chmod -R a+r tmpdist
	cd tmpdist && GZIP=--best tar chozf ../$(APP).tar.gz *
	rm -rf tmpdist

devdist: mrproper 
	cd ../../../ && GZIP=--best tar chozf $(APP).tar.gz aranym

dist: distclean
	cd ../../../ && GZIP=--best tar chozf $(APP).tar.gz --exclude=autogen.sh --exclude=CVS --exclude=.cvsignore aranym

depend dep:
	makedepend $(CPPFLAGS) $(DEFS) -Y. $(SRCS) -p$(OBJ_DIR)/ 2>/dev/null
	sed -n '/^# DO NOT DELETE THIS LINE -- make depend depends on it./,$$p' < Makefile > Makefile.wrk
	sed -n '1,/^# DO NOT DELETE THIS LINE -- make depend depends on it./p' < Makefile > Makefile.new
	mv Makefile.new Makefile
	tail -n +2 Makefile.wrk | sed 's=/../uae_cpu/fpu/=/=' > Makefile.new
	mv Makefile.new Makefile.wrk
	sed 's=/Unix/beos/=/Unix/=' < Makefile.wrk > Makefile.new
	mv Makefile.new Makefile.wrk
	sed 's=/Unix/cygwin/=/Unix/=' < Makefile.wrk > Makefile.new
	mv Makefile.new Makefile.wrk
	sed 's=/Unix/irix/=/Unix/=' < Makefile.wrk > Makefile.new
	mv Makefile.new Makefile.wrk
	sed 's=/Unix/linux/=/Unix/=' < Makefile.wrk > Makefile.new
	mv Makefile.new Makefile.wrk
	sed 's=/Unix/solaris/=/Unix/=' < Makefile.wrk > Makefile.new
	mv Makefile.new Makefile.wrk
	sed 's=/Unix/xbsd/=/Unix/=' < Makefile.wrk > Makefile.new
	mv Makefile.new Makefile.wrk
	sed 's=/../uae_cpu/=/=' < Makefile.wrk > Makefile.new
	mv Makefile.new Makefile.wrk
	sed 's=/../natfeat/=/=' < Makefile.wrk > Makefile.new
	mv Makefile.new Makefile.wrk
	sed 's=/../=/=' < Makefile.wrk >> Makefile
	rm -f Makefile.wrk

$(OBJ_DIR)/%.o : %.c
	$(CC) $(CPPFLAGS) $(DEFS) $(WFLAGS) $(CFLAGS) -c $< -o $@
$(OBJ_DIR)/%.o : %.m
	$(CC) $(CPPFLAGS) $(DEFS) $(WFLAGS) $(CFLAGS) -c $< -o $@
$(OBJ_DIR)/%.o : %.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) $(DBGSP) $(WFLAGS) $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/%.o : %.M
	$(CXX) $(CPPFLAGS) $(DEFS) $(DBGSP) $(WFLAGS) $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/%.o : %.s
	$(CXX) $(CPPFLAGS) $(DEFS) $(CFLAGS) -c $< -o $@

$(OBJ_DIR)/cpuopti: $(OBJ_DIR)/cpuopti.o
	$(CC) $(LDFLAGS) -o $(OBJ_DIR)/cpuopti $(OBJ_DIR)/cpuopti.o
$(OBJ_DIR)/build68k: $(OBJ_DIR)/build68k.o
	$(CC) $(LDFLAGS) -o $(OBJ_DIR)/build68k $(OBJ_DIR)/build68k.o
$(OBJ_DIR)/gencpu: $(OBJ_DIR)/gencpu.o $(OBJ_DIR)/readcpu.o $(OBJ_DIR)/cpudefs.o
	$(CXX) $(LDFLAGS) -o $(OBJ_DIR)/gencpu $(OBJ_DIR)/gencpu.o $(OBJ_DIR)/readcpu.o $(OBJ_DIR)/cpudefs.o
$(OBJ_DIR)/gencomp: $(OBJ_DIR)/gencomp.o $(OBJ_DIR)/readcpu.o $(OBJ_DIR)/cpudefs.o
	$(CXX) $(LDFLAGS) -o $(OBJ_DIR)/gencomp $(OBJ_DIR)/gencomp.o $(OBJ_DIR)/readcpu.o $(OBJ_DIR)/cpudefs.o

cpudefs.cpp: $(OBJ_DIR)/build68k ../uae_cpu/table68k
	$(OBJ_DIR)/build68k <../uae_cpu/table68k >cpudefs.cpp
cpustbl.cpp: cpuemu.cpp 
cpustbl_nf.cpp: cpustbl.cpp
compstbl.cpp: compemu.cpp
cputbl.h: cpuemu.cpp
comptbl.h: compemu.cpp

cpuemu.cpp: $(OBJ_DIR)/gencpu
	$(OBJ_DIR)/gencpu

compemu.cpp: $(OBJ_DIR)/gencomp
	$(OBJ_DIR)/gencomp

$(OBJ_DIR)/cpustbl_nf.o: cpustbl.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) $(CXXFLAGS) -DNOFLAGS -c $< -o $@

$(OBJ_DIR)/compemu_support.o: compemu_support.cpp comptbl.h codegen_x86.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) $(CXXFLAGS) -c $< -o $@

$(OBJ_DIR)/cpuemu1.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_1 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu2.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_2 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu3.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_3 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu4.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_4 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu5.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_5 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu6.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_6 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu7.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_7 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu8.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_8 $(CXXFLAGS) -c $< -o $@

$(OBJ_DIR)/cpuemu1_nf.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_1 -DNOFLAGS $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu2_nf.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_2 -DNOFLAGS $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu3_nf.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_3 -DNOFLAGS $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu4_nf.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_4 -DNOFLAGS $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu5_nf.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_5 -DNOFLAGS $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu6_nf.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_6 -DNOFLAGS $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu7_nf.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_7 -DNOFLAGS $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/cpuemu8_nf.o: cpuemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_8 -DNOFLAGS $(CXXFLAGS) -c $< -o $@

$(OBJ_DIR)/compemu1.o: compemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_1 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/compemu2.o: compemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_2 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/compemu3.o: compemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_3 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/compemu4.o: compemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_4 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/compemu5.o: compemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_5 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/compemu6.o: compemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_6 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/compemu7.o: compemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_7 $(CXXFLAGS) -c $< -o $@
$(OBJ_DIR)/compemu8.o: compemu.cpp
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_8 $(CXXFLAGS) -c $< -o $@

cpufast.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -S $(CXXFLAGS) $< -o cputmp.s
	$(OBJ_DIR)/cpuopti <cputmp.s >$@ || mv cputmp.s $@
	rm -f cputmp.s
cpufast1.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_1 -S $(CXXFLAGS) $< -o cputmp1.s
	$(OBJ_DIR)/cpuopti <cputmp1.s >$@ || mv cputmp1.s $@
	rm -f cputmp1.s
cpufast2.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_2 -S $(CXXFLAGS) $< -o cputmp2.s
	$(OBJ_DIR)/cpuopti <cputmp2.s >$@ || mv cputmp2.s $@
	rm -f cputmp2.s
cpufast3.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_3 -S $(CXXFLAGS) $< -o cputmp3.s
	$(OBJ_DIR)/cpuopti <cputmp3.s >$@ || mv cputmp3.s $@
	rm -f cputmp3.s
cpufast4.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_4 -S $(CXXFLAGS) $< -o cputmp4.s
	$(OBJ_DIR)/cpuopti <cputmp4.s >$@ || mv cputmp4.s $@
	rm -f cputmp4.s
cpufast5.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_5 -S $(CXXFLAGS) $< -o cputmp5.s
	$(OBJ_DIR)/cpuopti <cputmp5.s >$@ || mv cputmp5.s $@
	rm -f cputmp5.s
cpufast6.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_6 -S $(CXXFLAGS) $< -o cputmp6.s
	$(OBJ_DIR)/cpuopti <cputmp6.s >$@ || mv cputmp6.s $@
	rm -f cputmp6.s
cpufast7.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_7 -S $(CXXFLAGS) $< -o cputmp7.s
	$(OBJ_DIR)/cpuopti <cputmp7.s >$@ || mv cputmp7.s $@
	rm -f cputmp7.s
cpufast8.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_8 -S $(CXXFLAGS) $< -o cputmp8.s
	$(OBJ_DIR)/cpuopti <cputmp8.s >$@ || mv cputmp8.s $@
	rm -f cputmp8.s

cpufast_nf.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DNOFLAGS -S $(CXXFLAGS) $< -o cputmp.s
	$(OBJ_DIR)/cpuopti <cputmp.s >$@ || mv cputmp.s $@
	rm -f cputmp.s
cpufast1_nf.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_1 -DNOFLAGS -S $(CXXFLAGS) $< -o cputmp1.s
	$(OBJ_DIR)/cpuopti <cputmp1.s >$@ || mv cputmp1.s $@
	rm -f cputmp1.s
cpufast2_nf.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_2 -DNOFLAGS -S $(CXXFLAGS) $< -o cputmp2.s
	$(OBJ_DIR)/cpuopti <cputmp2.s >$@ || mv cputmp2.s $@
	rm -f cputmp2.s
cpufast3_nf.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_3 -DNOFLAGS -S $(CXXFLAGS) $< -o cputmp3.s
	$(OBJ_DIR)/cpuopti <cputmp3.s >$@ || mv cputmp3.s $@
	rm -f cputmp3.s
cpufast4_nf.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_4 -DNOFLAGS -S $(CXXFLAGS) $< -o cputmp4.s
	$(OBJ_DIR)/cpuopti <cputmp4.s >$@ || mv cputmp4.s $@
	rm -f cputmp4.s
cpufast5_nf.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_5 -DNOFLAGS -S $(CXXFLAGS) $< -o cputmp5.s
	$(OBJ_DIR)/cpuopti <cputmp5.s >$@ || mv cputmp5.s $@
	rm -f cputmp5.s
cpufast6_nf.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_6 -DNOFLAGS -S $(CXXFLAGS) $< -o cputmp6.s
	$(OBJ_DIR)/cpuopti <cputmp6.s >$@ || mv cputmp6.s $@
	rm -f cputmp6.s
cpufast7_nf.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_7 -DNOFLAGS -S $(CXXFLAGS) $< -o cputmp7.s
	$(OBJ_DIR)/cpuopti <cputmp7.s >$@ || mv cputmp7.s $@
	rm -f cputmp7.s
cpufast8_nf.s: cpuemu.cpp $(OBJ_DIR)/cpuopti
	$(CXX) $(CPPFLAGS) $(DEFS) -DPART_8 -DNOFLAGS -S $(CXXFLAGS) $< -o cputmp8.s
	$(OBJ_DIR)/cpuopti <cputmp8.s >$@ || mv cputmp8.s $@
	rm -f cputmp8.s

# For tests
newcpu.s: ../uae_cpu/newcpu.cpp
	$(CXX) -fverbose-asm $(CPPFLAGS) $(DEFS) -S $(CXXFLAGS) ../uae_cpu/newcpu.cpp -o newcpu.s

memory.s: ../uae_cpu/memory.cpp
	$(CXX) -fverbose-asm $(CPPFLAGS) $(DEFS) -S $(CXXFLAGS) ../uae_cpu/memory.cpp -o memory.s

$(APP_IFC): aratapif.c
	$(CC) $(LDFLAGS) $(CFLAGS) -o $(APP_IFC) -DHAVE_AFINET aratapif.c

$(APP).1.gz: ../../doc/$(APP).1
	gzip -c ../../doc/$(APP).1 > $(APP).1.gz

#-------------------------------------------------------------------------
# DO NOT DELETE THIS LINE -- make depend depends on it.
