<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>ARAnyM from scratch</title>
</head><body>

<h1>Howto create your own ARAnyM setup from scratch</h1>

<p>We, ARAnyM developpers hear many horror tales about ARAnyM installation, configuration
and setup by beginners, or even people which know a lot about Atari computers.<br>
<br>
Maybe we should share knowledge about how we got a working configuration using
ARAnyM and pure Atari software? So let's start.
</p>

<h2>1. Compilation, getting an ARAnyM binary</h2>

<p>If you are skilled enough to compile sources, you don't need any help, except
for knowing which elements you need to enable at configure time. [TODO].<br>
<br>
For now, I consider you got a binary for ARAnyM (either .exe or anything else that
can be launched).
</p>

<h2>2. First try</h2>

<p>If you do a fresh start (no existing configuration file), you'd better launch
ARAnyM from a console window (the black/white thing where you type mystical commands),
whatever your OS (Linux, win32, or MacOSX). It will be easier for you to know what
prevents ARAnyM from working.</p>

<pre>
$ aranym
ARAnyM 0.9.2pre1
Config file '/home/patrice/.aranym/config' not found.
The config file is created with default values. Edit it to suit your needs.
TOS image '/usr/local/share/aranym/ROM' not found.
EmuTOS image '/usr/local/share/aranym/etos512k.img' not found.
No operating system found. ARAnyM can not boot!
Visit http://emutos.sourceforge.net/ and get your copy of EmuTOS now.
Couldn't protect ROM
</pre>

<p>So what do have? First, it does not find its configuration file (the path to
this file is OS-dependent, it should written somewhere in the doc). On any Unix
system, it is '${HOME}/.aranym/config'. As the program says, it creates a default
one, so you only need to read where it is created, and then you'll have to edit it
to suit your needs.<br>
<br>
You'll also get a default nvram setting, which is VGA monitor, 320x200x16 colors
boot screen and some other default setting for date format, keyboard and country.
You can change it by using a nvram utility like 'bootconf.prg'.
</p>

<h2>3. Setup the operating system</h2>

<p>First thing needed for any machine to boot: an operating system. In original
Atari machines the operating system (TOS) was stored in a ROM (read only memory - a hardware chip).
ARAnyM supports original TOS 4.04 from Atari Falcon030 in a form of so called "ROM image" (a file
that contains the data read from the ROM chip). ARAnyM also supports a free TOS replacement called
<a href="http://emutos.sourceforge.net">EmuTOS</a>. Third possibility is to boot the Linux-m68k kernel.<br>
<br>
Once you get one, edit the config file, in the section [GLOBAL], you have one line
'TOS=/path/to/tos404.img' to edit, and/or 'EmuTOS=/path/to/emutos.img' if you want
to try/use EmuTOS instead. Linux-m68k kernel got its own [LILO] section in the config file.<br>
<br>
Default is to use original TOS, if not found, ARAnyM uses EmuTOS. You can force
EmuTOS usage by adding '-e' or '--emutos' as command-line parameter to ARAnyM. Similarly you can force Linux-m68k boot by adding "-l" or "--lilo" command-line parameter.<br>
<br>
Now the virtual machine should run, and with TOS, after the Atari logo, you should reach
the GEM desktop.
</p>

<pre>
$ aranym
ARAnyM 0.9.2pre1
Using config file: '/home/patrice/.aranym/config'
[snip]
TOS 4.04 loading... [OK]
NVRAM loaded from '/home/patrice/.aranym/nvram'
TunTap(0): ERROR: aratapif not found. Ethernet disabled!
TunTap(0): ERROR: aratapif not found. Ethernet disabled!
Reseting weird mouse packet: 540, 338, 0
Reseting weird mouse packet: -479, -338, 0
Floppy read(-1, 001cc6, 1) failed.
</pre>

<p>Wanna try EmuTOS?</p>

<pre>
$ aranym -e
ARAnyM 0.9.2pre1
Using config file: '/home/patrice/.aranym/config'
[snip]
EmuTOS 2005/09/18 loading from '/usr/local/share/atari-emu/emutos-0.8.1-512k.img'... [OK]
NVRAM loaded from '/home/patrice/.aranym/nvram'
TunTap(0): ERROR: aratapif not found. Ethernet disabled!
TunTap(0): ERROR: aratapif not found. Ethernet disabled!
BIOS: Detected memory: ST-RAM = 14 MB, FastRAM = 0 MB
BDOS: Address of basepage = 00013000
BDOS: cinit - osinit successful ...
Detected scancode offset = 8 (key: 'space' with scancode $41)
Floppy read(-1, 009fcc, 1) failed.
hdv_boot returns 3
Panic: bus error. misc = 0x2000, address = 0x00e01254
opcode = 0x7008, sr = 0x602e, pc = 0x02060000
Aregs: 602e0206 00e2bdac 00018a40 00018c74  00000000 00014a90 000151da 00015144
Dregs: 0000046c 00000004 0000001c 00000000  00000000 00000000 00000000 00000000
Processor halted.
</pre>

<p>I guess EmuTOS really needs a HardDisk image to be booted. I will retry as soon
as I have one.</p>

<h2>4. Create and setup a hard disk image</h2>

<p>I won't explain how to use a real hard disk from your old Atari computer, it is
safer to use a blank disk image to test. So, I will make it using TOS.<br>
<br>
Run ARAnyM, once you reach the GEM desktop, press 'Pause' (or the OS-dependent key
which has this feature, read the doc), and go to disk submenu. There you can choose
the floppy disk image, and one hard disk image for each IDE device (master and
slave).<br>
<br>
Select 'Path' and choose the location (and name) of the hd image. Then select the
size (in MB), and click 'Generate'. ARAnyM asks for confirmation, then does its job.
A geometry has been chosen for this hd image (C/H/S = 8/16/63). Enable it by selecting
the 'Present' checkbox. Select 'Apply' to go back to menu, then save the config
file. If you shutdown ARAnyM, and edit the config file, you'll find what has
been done in section [IDE0] of the config file.<br><br>
On a real machine, it means we have plugged an hard disk in our machine, it does
not mean there is software to drive it, which is the task of a hard disk driver.
EmuTOS has one embedded, whereas TOS has not. However, the hard disk image must be
partitionned to be used directly by EmuTOS:</p>

<pre>
$ aranym -e
ARAnyM 0.9.2pre1
Using config file: '/home/patrice/.aranym/config'
[snip]
[IDE0] configuration: found 9 valid directives.
[snip]
hda: Non-ATARI root sector
[snip]
</pre>

<p>We need software to partition our hard disk image. Either from host side (with
host specific tools that must create an Atari root sector), or from Atari side
(using floppy disks or images to run software).</p>

<h2>5. Partition the hard disk image (Atari side)</h2>

<p>We can use several Atari Hard Disk drivers:</p>

<ul>
<li>AHDI, from Atari (partition utility is named hdx)
<li>CBHD, from Steffen Engel
<li>Cecile, from Centek
<li>HD Driver, from Uwe Seimet
<li>SCSI tools, from Julian Reschke
</ul>

<p>You can find some of them here:</p>

<ul>
<li><a href="http://ftp.lip6.fr/pub/atari/Disk/">http://ftp.lip6.fr/pub/atari/Disk/</a>
<li><a href="http://atari.apinc.org/atari/download/disks.htm">http://atari.apinc.org/atari/download/disks.htm</a>
<li><a href="http://www.seimet.de/atari_english.html">http://www.seimet.de/atari_english.html</a>
<li><a href="http://centek.online.fr/atari/softs/s_cecile.htm">http://centek.online.fr/atari/softs/s_cecile.htm</a>
</ul>

<p>The question is, which ones work with ARAnyM?</p>

<h3>5.1 Atari HDX 5.04</h3>

<p>I got one error message when going to menu Disk->Partition, and ARAnyM crashes:</p>

<pre>
hard drive: io read to address f00001 unsupported
hard drive: shouldnt get here!
Segmentation fault
</pre>

<h3>5.2 Cecile 2.22</h3>

<p>First run cecile.prg, so the partition utility (cc_tools.prg) can access the
IDE hard disk. Run cc_tools.prg, select 'partition', then the first IDE hard disk.
Create one partition on this hard disk. Then select 'install' to install the cecile.sys
hard disk driver on it, selecting the first partition to boot from. Bingo, you
can reboot ARAnyM, and it is now booting from the IDE disk image.<br>
<br>
EmuTOS checks for partitions sizes against the whole disk size, and refuse to use
the disk if partitions have boundaries outside the disk. The last partition created
with Cecile on a hard disk has a wrong size (2 sectors off limits), and if you
have only 1 partition created, its size is wrong, and EmuTOS won't use it.
</p>

<h3>5.3 HD Driver 8.1 demo</h3>

<p>You can run hddriver.prg, but when running hddrutil.prg, partition is not
available in the demo.<br>
<br>
[Need someone with full version to do the test]
</p>

<h3>5.4 CBHD 5.02</h3>

<p>Run 'cbhd.prg' for the utility to reach the IDE disk. Then run 'cbhdconf.app'.
When you try to partition, there are some errors coming from ARAnyM, and partitioning
fails:</p>

<pre>
SET FEATURES with unknown subcommand: 0x88
SET FEATURES with unknown subcommand: 0x88
SET FEATURES with unknown subcommand: 0x88
SET FEATURES with unknown subcommand: 0x8a
SET FEATURES with unknown subcommand: 0x8a
SET FEATURES with unknown subcommand: 0x8a
hard drive: RESET
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
</pre>

<h3>5.5 SCSI Tools</h3>

<p>[Need someone with full version to do the test]</p>

</body></html>
